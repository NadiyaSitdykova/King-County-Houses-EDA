King County Houses Exploration by Nadiya Sitdykova
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(GGally)
library(date)
library(memisc)
library(Hmisc)
library(psych)
```
This report explores a dataset containing prices and attributes for approximately 22,000 houses.

```{r echo=FALSE, Load_the_Data}
# Load the Data
kc_house <- read.csv("kc_house_data.csv")
# subset columns of interest
kc_house <- kc_house[c('date', 'price', 'bedrooms', 'bathrooms', 'sqft_living', 
                       'sqft_lot', 'waterfront', 'view', 'condition', 
                       'yr_built', 'yr_renovated')]

# add day and month from date
formatted_date <- strptime(kc_house$date, "%Y%m%dT000000")
kc_house$month <- month(formatted_date)
kc_house$day <- day(formatted_date)
# add new columns
kc_house <- transform(kc_house, price_thousands = price / 1000)
kc_house <- transform(kc_house, yr_build_or_renovated = max(yr_built, yr_renovated))

# process factors
kc_house$waterfront <- factor(kc_house$waterfront, levels = c(0, 1), ordered = T)
kc_house$view <- factor(kc_house$view, levels = c(0:4), ordered = T)
kc_house$condition <- factor(kc_house$condition, levels = c(1:5), ordered = T)
kc_house$day <-factor(kc_house$day, levels = c(1:31), ordered = T)
kc_house$month <- factor(kc_house$month, levels = c(1:12), ordered = T)
```
# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
dim(kc_house)
```

```{r echo=FALSE, Univariate_Plots}
str(kc_house)
```

Our dataset consists of 21 variables, with almost 22,000 observations.

```{r echo=FALSE, Univariate_Plots}
summary(kc_house)
```



```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = price_thousands)) +
  geom_histogram(binwidth = 100)
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = price_thousands)) +
  geom_histogram(binwidth = 0.01) +
  scale_x_log10(breaks = c(0, 100, 200, 450, 1500, 4000))
```

Above is original and transformed data. As an original plot has a long tail, logarithmic trahsformations was appplied for better understanding of the price distribution. The tranformed price distribution appears to be approximately normal with the price peaking around 450 thousands. Now let's see how this plot looks like across the categorical variables of waterfornt, view and condition.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = waterfront)) +
  geom_bar()
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = view)) +
  geom_bar()
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = condition)) +
  geom_bar()
```

As we can see, the most houses are not overlooking the waterfront and have view graded as zero. Condition is skewed to the right, with most houses of condition 3 and greater. Also interesting to look at the distribution of day and month when house was sold.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = month)) +
  geom_bar()
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = day)) +
  geom_bar()
```

The month data has a peak around May, and have significantly lower count of sold houses in the beginning of the year. Distribution of days looks uniform, with significantly low value at 31st. But this could be explained by absense of 31st in about a half of months, so no surprise here.

```{r echo=FALSE, warning=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = bedrooms)) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(0, 11))
```

```{r echo=FALSE, warning=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = bedrooms)) +
  geom_histogram(binwidth = 0.25) +
  scale_x_continuous(breaks = seq(0, 11, 1), limits = c(0, 11))
```

```{r echo=FALSE, Univariate_Plots}
summary(kc_house$bedrooms)
```

```{r echo=FALSE, Univariate_Plots}
table(kc_house$bedrooms)
```
The smaller houses has 0 bedrooms and the largest one has 33 bedrooms (wow!). The plots above exclude the house with 33 bedrooms as it's clearly an outlier. All houses has whole number of bedrooms and most popular are houses with 3 bedrooms.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = bathrooms)) +
  geom_histogram()
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = bathrooms)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = seq(0, 8, 0.5))
```

```{r echo=FALSE, Univariate_Plots}
summary(kc_house$bathrooms)
```

```{r echo=FALSE, Univariate_Plots}
table(kc_house$bathrooms)
```
The maximal nuber of bathrooms is 8 and all values of bathrooms are multiplies of 0.25. Most popular houses have 2.5 bathrooms. What is suspicious, that is a ten houses with zero bathrooms. Let's look at this houses closer.
```{r echo=FALSE}
subset(kc_house, bathrooms == 0)
```
I guess it is what it is: some houses don't have bathrooms. Other information about those houses looks valid.
```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = sqft_living)) +
  geom_histogram() 
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = sqft_living)) +
  geom_histogram(binwidth = 0.01) +
  scale_x_log10(breaks = c(0, 500, 1000, 2000, 10000))
```

```{r echo=FALSE, Univariate_Plots}
summary(kc_house$sqft_living)
```
Above is original and transformed data. As an original plot has a long tail, logarithmic trahsformations was appplied for better understanding of the living area distribution. Most houses have a living area between 1400 sqft and 2600 sqft: median 1910 sqft and mean 2080 sqft.
```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = sqft_lot)) +
  geom_histogram() 
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = sqft_lot)) +
  geom_histogram() +
  scale_x_log10(breaks = c(1000, 3000, 8000, 100000, 1000000))
```

```{r echo=FALSE, Univariate_Plots}
summary(kc_house$sqft_lot)
```
And again, we applied logarithmic trahsformation to the lot area. Most houses have a lot area between 5040 sqft and 10690 sqft: median 7618 sqft and mean 15110 sqft.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = yr_built)) +
  geom_histogram(binwidth = 1) 
```

```{r echo=FALSE, Univariate_Plots}
summary(kc_house$yr_built)
```

Interestingly, this plot in some degree shows economic situation in the country. For example we can see the lowest values around 1930 (Great Depression) and drop around 2008 (Financial Crisis). Significantly low value for 2015 can be explained by the fact, that data collected from May 2014 to May 2015. Most houses was built between 1975 and 1997.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = kc_house, aes(x = yr_renovated)) +
  geom_histogram()
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data = subset(kc_house, yr_renovated > 0), aes(x = yr_renovated)) +
  geom_histogram(binwidth = 1)
```

```{r echo=FALSE, Univariate_Plots}
table(kc_house$yr_renovated)
```
```{r echo=FALSE, Univariate_Plots}
kc_house_renovated = subset(kc_house, yr_renovated > 0)
summary(kc_house_renovated$yr_renovated)
```

I excluded data for not renovated houses in second plot in order to zoom in for data around 2000. We can see that a lot of renovations was made in 2014, which is understandable: owners renovated their old houses right before sale. Amongst renovated houses most of them were renovated between 1987 and 2007: median 2000 and mean 1996.

# Univariate Analysis

### What is the structure of your dataset?
There are 21,613 houses in the dataset with 10 features (date, price, bedrooms, bathrooms, sqft_living, sqft_lot, waterfront, view, condition, yr_built, yr_renovated). The variables waterfront, view, and condition, are ordered factor variables with the following levels.

(worst) —————-> (best)
waterfront: 0, 1
view: 0, 1, 2, 3, 4
condition: 1, 2, 3, 4, 5

Other observations:

*
*
*
*
*

### What is/are the main feature(s) of interest in your dataset?
The main features of interest in the dataset is price. I’d like to determine which features are best for predicting the price of a house. I suspect some combination of the variables can be used to build a predictive model to price houses.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
View, condition, bedrooms, sqft_living, sqft_lot and yr_build are likely contribute to the price of a house. I think sqft_living, condition and yr_build contribute most to the price after researching information on house prices. One of the most importat things in house pricing is location. But I decided to exclude this variable as the all data is from the same county.

### Did you create any new variables from existing variables in the dataset?
I created two variable for the day and month of purchase of using the information from date. I've heard that during winter prices are lower, so it was particulary interesting for me to check this.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

I log-transformed the right skewed price, sqft_living and sqft_lot ditstributions. 

# Bivariate Plots Section

```{r echo=FALSE, Bivariate_Plots}
set.seed(20022012)
house_samp <- kc_house[sample(1:length(kc_house$price), 10000), c(2:12)]
ggpairs(house_samp, 
  lower = list(continuous = wrap("points", shape = I('.'))), 
  upper = list(combo = wrap("box", outlier.shape = I('.'))))
```

The numbers of bedrooms and bathrooms tend to correlate with each other. The greater number of bathrooms or bedrooms, then the larger the whole living area of the house. Price correlates strongly with living area and number of bathrooms and bedrooms.

From this data, sqft_lot, yr_built and yr_renovated do not seem to have significatn correlations with price, but year when house was built moderately correlates with number of bathrooms and living area. I want to look closer at scatter plots involving price and some other variables like sqft_living, sqft_lot, bedrooms, bathrooms, yr_built, yr_renovated.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = sqft_living, y = price_thousands)) +
  geom_point(alpha = 1/20) +
  xlim(0, quantile(kc_house$sqft_living, 0.99)) +
  ylim(0, quantile(kc_house$price_thousands, 0.99)) +
  geom_smooth()
```

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = round(sqft_living / 100) * 100, y = price_thousands)) +
  geom_point(alpha = 1/20, color = "orange") +
  xlim(0, quantile(kc_house$sqft_living, 0.99)) +
  ylim(0, quantile(kc_house$price_thousands, 0.99)) +
  geom_line(stat = "summary", fun.y = "mean") +
  geom_line(stat = "summary", fun.y = "median", color = "blue") + 
  geom_line(stat = "summary", fun.y = "quantile", fun.args = list(probs = .1), color = "blue", linetype = 2) +  
  geom_line(stat = "summary", fun.y = "quantile", fun.args = list(probs = .9), color = "blue", linetype = 2)
```

As living area increases, the variance in price increases. The most houses represent a cloud with a high density below 700 thousands price. The relationship between price and sqft_living appears to be exponential rather than linear.


```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = sqft_lot, y = price_thousands)) +
  geom_point(alpha = 1/20, position = 'jitter') +
  xlim(0, quantile(kc_house$sqft_lot, 0.9)) +
  ylim(0, quantile(kc_house$price_thousands, 0.9))
```
There is no much correlation between price and sqft_lot, but we can see some vertical bands where many houses with the same lot area have different price points. This bands could be explained by estimating lot area with the round values.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = bedrooms, y = price_thousands)) +
  geom_point()
```

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = bedrooms, y = price_thousands)) +
  geom_point(alpha = 1/20, position = 'jitter') +
  xlim(0, quantile(kc_house$bedrooms, 0.99)) +
  ylim(0, quantile(kc_house$price_thousands, 0.99))
```
```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(bedrooms, price_thousands))
```

Again, the tall vertical strips indicate bedrooms numbers are integers. Adding jitter, transparency, and changing the plot limits lets us see the slight correlation between bedrooms and price.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = bathrooms, y = price_thousands)) +
  geom_point()
```

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = bathrooms, y = price_thousands)) +
  geom_point(alpha = 1/20, position = 'jitter') +
  xlim(0, quantile(kc_house$bathrooms, 0.99)) +
  ylim(0, quantile(kc_house$price_thousands, 0.99)) +
  geom_smooth()
```
```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(bathrooms, price_thousands))
```


Then again, the tall vertical strips indicate bathrooms numbers are multiplies 0.25. Adding jitter, transparency, and changing the plot limits lets us see the correlation between bathrooms and price.
```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = yr_built, y = price_thousands)) +
  geom_point()
```

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = yr_built, y = price_thousands)) +
  geom_point(alpha = 1 / 20, position = 'jitter') +
  xlim(min(kc_house$yr_built), quantile(kc_house$yr_built, 0.99)) +
  ylim(0, quantile(kc_house$price_thousands, 0.99)) +
  geom_line(stat = "summary", fun.y = "mean") +
  geom_line(stat = "summary", fun.y = "median", color = "blue") + 
  geom_line(stat = "summary", fun.y = "quantile", fun.args = list(probs = .1), color = "blue", linetype = 2) +  
  geom_line(stat = "summary", fun.y = "quantile", fun.args = list(probs = .9), color = "blue", linetype = 2)
```

We can see two outliers with price over 4000 before 1950 and significantly more houses with extremely high price built after 1975. Adding transparency and adjusting limits didn't reveal any strong patterns. We can see that medain and mean stays approximately same for different yr_built. But what is clear, is that most houses was built after 1950, as we can see there are more points there.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house_renovated, aes(x = yr_renovated, y = price_thousands)) +
  geom_point()
```


```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house_renovated, aes(x = yr_renovated, y = price_thousands)) +
  geom_point(alpha = 1/10) +
  geom_line(stat = 'summary', fun.y = 'median')
```

Amongst renovated houses we can see weak correlation between price and yr_renovated. Also form this plot it's clear that most houses was renovated recently.

Next, I’ll look at how the categorical features vary with sqft_living and price.
```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = waterfront, y = sqft_living)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$sqft_living, 0.99))
```
In general houses with waterfront seems to have larger living area.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = waterfront, y = price_thousands)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$price_thousands, 0.99))
```
```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(price_thousands, as.numeric(waterfront), method = 'spearman', conf.level = 0.95, exact = FALSE))
```

Houses with waterfront seems to have a higher price, but we also should remember that in could be partially result of larger living area. Variation of price is higher for houses with waterfront. Spearman's coefficient shows us that correlation is very weak.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = view, y = sqft_living)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$sqft_living, 0.99))
```
There is a tendency that houses with better view have larger living area.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = view, y = price_thousands)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$price_thousands, 0.99))
```
```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(price_thousands, as.numeric(view), method = 'spearman', conf.level = 0.95, exact = FALSE))

```

Houses with better view seems to have higher price, but then again, we should'n forget about posible effect of larger living area.
Variation of price have a tendency to increase with better levels of view. Spearmans rank shows us the a weak correlation.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = condition, y = sqft_living)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$sqft_living, 0.99))
```
```{r echo=FALSE, Bivariate_Plots}
by(kc_house$sqft_living, kc_house$condition, summary)
```

It seems that houses with poor condition (below 3) have smaller living area, but for other conditions sqft_living distributions are similar. Although condition 3 have highest median and 25%, 75% quantiles. 

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = condition, y = price_thousands)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$price_thousands, 0.99))
```
```{r echo=FALSE, Bivariate_Plots}
by(kc_house$price_thousands, kc_house$condition, summary)
```

```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(price_thousands, as.numeric(condition), method = 'spearman', conf.level = 0.95, exact = FALSE))
```

Here we see the similar to living area picture. First two conditions have lower price, but other conditions are not very different. Although excellent condition(5) has highest quartiles for price. Spearmans rank shows us very weak correlation.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = month, y = sqft_living)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$sqft_living, 0.99))
```
It seems that living area have similar distributions during different month, but let's zoom in.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = month, y = sqft_living)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(1000, 3000))
```
```{r echo=FALSE, Bivariate_Plots}
by(kc_house$sqft_living, kc_house$month, summary)
```

The highest living area median is in July (1950 sqft) and the lowest median is in February(1830 sqft). But actually 120 sqft is not much difference for houses, so I woudn't say that living area isn't similar by months.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = month, y = price_thousands)) +
  geom_boxplot() +
  ylim(0, quantile(kc_house$price_thousands, 0.99))
```
Let's zoom in
```{r echo=FALSE, Bivariate_Plots}
ggplot(data = kc_house, aes(x = month, y = price_thousands)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(250, 750))
```

```{r echo=FALSE, Bivariate_Plots}
by(kc_house$price_thousands, kc_house$month, summary)
```

```{r echo=FALSE, Bivariate_Plots}
with(kc_house, cor.test(price_thousands, as.numeric(month), method = 'spearman', conf.level = 0.95, exact = FALSE))
```

Then again, the highest median price is in June and July (465 thousands) and the lowest median price is in February (425.5 thousands). In general there is kind of peak in summer and slight price drop in winter. So, I guess, seasons affect the price very slightly, if at all. Spearmans rank shows us very weak correlation.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

Price correlates strongly with living area and number of bathrooms. Also price slightly correlates with number of bedrooms. I found this interesting, that number of bathrooms correlates with price stronger, than with number of bathrooms.

As living area increases, the variance in price increases. In the plot of price vs sqft_living The most houses represent a cloud with a high density below 700 thousands price. The relationship between price and sqft_living appears to be exponential rather than linear.

From this data, sqft_lot, yr_built and yr_renovated do not seem to have significatn correlations with price, but year when house was built moderately correlates with number of bathrooms and living area.

Houses overlooking waterfrong have much higher median price than houses without waterfront. Also price variance is higher for houses with waterfront.

Houses with better levels of view and condition tend to occur more often at lower prices while houses with worse levels of view and condition tend to occur more often at higher prices.

Houses in condition 3 out of 5 have the highes median living area. The median price for condition 4 is lower than for condition 3, which is interesting.

Variation of price have a tendency to increase with better levels of view and then decrease for excellent view (4).

The highest median price is in June and July and the lowest median price is in February. The median price is typically lower in winter and higher in summber.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

The numbers of bedrooms and bathrooms tend to correlate with each other. The greater number of bathrooms or bedrooms, then the larger the whole living area of the house which makes sense.

### What was the strongest relationship you found?

The price of a house is positively and strongly correlated with living area. Number of bedrooms and bathrooms correlate with the price, but less strongly than living area. Variable sqft_living could be used in a model to make house price predictions. But we shouldn't use bathrooms and bedrooms then, because they measuring the same quality and show strong correlation with sqft_living.


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```

```{r echo=FALSE, Multivariate_Plots}

```
# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
